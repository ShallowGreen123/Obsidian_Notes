{"ID":"20240527172503-6k9ljq0","Spec":"1","Type":"NodeDocument","Properties":{"icon":"1f7e0","id":"20240527172503-6k9ljq0","tags":"LVGL,ESP32,PlatformIO","title":"lvgl、esp32、文件系统","type":"doc","updated":"20240528174451"},"Children":[{"ID":"20240528174451-k83muna","Type":"NodeParagraph","Properties":{"id":"20240528174451-k83muna","updated":"20240528174451"},"Children":[{"Type":"NodeText","Data":"本次使用 ESP32S3 16N8R、LVGL v8.3.10、PlatformIO Core, version 6.1.15"}]},{"ID":"20240527172503-q0t7qah","Type":"NodeParagraph","Properties":{"id":"20240527172503-q0t7qah","updated":"20240527175445"},"Children":[{"Type":"NodeText","Data":"使用 ESP32 在 PlatformIO 环境下使用文件系统，实现需求：在 ESP32 中，使用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lv_img_set_src(img, \u0026quot;S:/image.png\u0026quot;);"},{"Type":"NodeText","Data":"​ 的形式，访问到 SD卡或者 spiffs 里面的图片，然后显示在显示屏上面。需要进行下面几步操作；"}]},{"ID":"20240528173958-q9qc5s4","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20240528173958-q9qc5s4","updated":"20240528174443"},"Children":[{"ID":"20240528174001-mgdwa8s","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20240528174001-mgdwa8s","updated":"20240528174001"},"Children":[{"ID":"20240528174001-yvflb34","Type":"NodeParagraph","Properties":{"id":"20240528174001-yvflb34","updated":"20240528174035"},"Children":[{"Type":"NodeText","Data":"在 PlatformIO 上面初始化 SD 卡，确保 SD 可以正常工作；"}]}]},{"ID":"20240528174035-z4zsbck","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20240528174035-z4zsbck"},"Children":[{"ID":"20240528174035-o7mifpb","Type":"NodeParagraph","Properties":{"id":"20240528174035-o7mifpb","updated":"20240528174230"},"Children":[{"Type":"NodeText","Data":"更改 LVGL 的 FS 第三方库，将 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lv_fs_fatds.c"},{"Type":"NodeText","Data":"​ 文件里的函数 fs_dir_open 中的 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"DIR"},{"Type":"NodeText","Data":"​ 改为 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"FF_DIR"},{"Type":"NodeText","Data":"​;"}]}]},{"ID":"20240528174234-gbt5102","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20240528174234-gbt5102"},"Children":[{"ID":"20240528174234-7321cmk","Type":"NodeParagraph","Properties":{"id":"20240528174234-7321cmk","updated":"20240528174343"},"Children":[{"Type":"NodeText","Data":"更改 LVGL 的配置文件，使能用户定义内存申请函数、使能文件系统；"}]}]},{"ID":"20240528174348-j8orp0m","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"NC4=","Num":4},"Properties":{"id":"20240528174348-j8orp0m","updated":"20240528174443"},"Children":[{"ID":"20240528174348-9ts03fg","Type":"NodeParagraph","Properties":{"id":"20240528174348-9ts03fg","updated":"20240528174443"},"Children":[{"Type":"NodeText","Data":"最后就可以在 LVGL 按照下面的方式，访问图片了 ( 注意使能图像解码的宏定义 )；"}]}]}]},{"ID":"20240527173126-8dxzow3","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527173126-8dxzow3","updated":"20240527173341"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"lv_img_set_src(img, \"S:/image.png\");\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527173345-zru51bh","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240527173345-zru51bh","updated":"20240527174310"},"Children":[{"Type":"NodeText","Data":"1、更改 LVGL 的三方库"}]},{"ID":"20240527173320-tb2t2ek","Type":"NodeParagraph","Properties":{"id":"20240527173320-tb2t2ek","updated":"20240527173904"},"Children":[{"Type":"NodeText","Data":"在 LVGL 中打开文件 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lvgl\\src\\extra\\libs\\lv_fs_fatds.c"},{"Type":"NodeText","Data":"​，更改函数 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"fs_dir_open"},{"Type":"NodeText","Data":"​ (在文件搜索一下 fs_dir_open );"}]},{"ID":"20240527173905-a90h2za","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527173905-a90h2za","updated":"20240527174025"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"// 更改前的 fs_dir_open 函数\nstatic void * fs_dir_open(lv_fs_drv_t * drv, const char * path)\n{\n    LV_UNUSED(drv);\n    DIR * d = lv_mem_alloc(sizeof(DIR));\n    if(d == NULL) return NULL;\n\n    FRESULT res = f_opendir(d, path);\n    if(res != FR_OK) {\n        lv_mem_free(d);\n        d = NULL;\n    }\n    return d;\n}\n\n// 更改后的 fs_dir_open 函数\nstatic void * fs_dir_open(lv_fs_drv_t * drv, const char * path)\n{\n    LV_UNUSED(drv);\n    FF_DIR * d = lv_mem_alloc(sizeof(FF_DIR));  // 将 DIR * 改为了 FF_DIR *\n    if(d == NULL) return NULL;\n\n    FRESULT res = f_opendir(d, path);\n    if(res != FR_OK) {\n        lv_mem_free(d);\n        d = NULL;\n    }\n    return d;\n}\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527174031-qd89esy","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240527174031-qd89esy","updated":"20240527174310"},"Children":[{"Type":"NodeText","Data":"2、更改 LVGL 配置文件"}]},{"ID":"20240527174120-fp251sk","Type":"NodeParagraph","Properties":{"id":"20240527174120-fp251sk","updated":"20240527174136"},"Children":[{"Type":"NodeText","Data":"在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lv_conf.h"},{"Type":"NodeText","Data":"​ 中，将下面部分改为下图所示的样子："}]},{"ID":"20240527174137-z1mh6o0","Type":"NodeParagraph","Properties":{"id":"20240527174137-z1mh6o0","updated":"20240527174148"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240525172826-0nw8ur8.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240527174155-r4e6rl8","Type":"NodeParagraph","Properties":{"id":"20240527174155-r4e6rl8","updated":"20240527174155"},"Children":[{"Type":"NodeText","Data":"在 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"lv_conf.h"},{"Type":"NodeText","Data":"​ 中使能 FATFS 文件系统；"}]},{"ID":"20240527174202-h3n3x0o","Type":"NodeParagraph","Properties":{"id":"20240527174202-h3n3x0o","updated":"20240527174203"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240525172919-y2230nq.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240527174207-btbmpyl","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240527174207-btbmpyl","updated":"20240527174310"},"Children":[{"Type":"NodeText","Data":"3、使用文件系统读取图片"}]},{"ID":"20240527174310-kzo975q","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20240527174310-kzo975q","updated":"20240527174310"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"Yw=="},{"Type":"NodeCodeBlockCode","Data":"lv_obj_t *img = lv_img_create(lv_scr_act());\nlv_obj_center(img);\nlv_img_set_src(img, \"S:/image.png\");\n\n/** 注意，在使用图片时，可以使用 LVGL 自带的图片解码器；需要在 lv_conf.h 中设置相应的宏；\n\n#define LV_USE_PNG 1   // Enable PNG decoder library\n#define LV_USE_BMP 1   // Enable BMP decoder library\n#define LV_USE_SJPG 1  // Enable JPG + split JPG decoder library\n#define LV_USE_GIF 1   // Enable GIF decoder library\n\n*/\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20240527174201-2hfol83","Type":"NodeParagraph","Properties":{"id":"20240527174201-2hfol83","updated":"20240527174246"}}]}